
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>随笔小记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="sksun">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="随笔小记">
<meta property="og:url" content="http://sksun.com.cn/page/7/index.html">
<meta property="og:site_name" content="随笔小记">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="随笔小记">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="随笔小记">随笔小记</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:sksun.com.cn">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/25/Defer, Panic, and Recover/" title="Defer, Panic, and Recove" itemprop="url">Defer, Panic, and Recove</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-05-25T08:07:05.000Z" itemprop="datePublished"> Published 2018-05-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>本文译自(Defer, Panic, and Recove)[<a href="https://blog.golang.org/defer-panic-and-recover]" target="_blank" rel="noopener">https://blog.golang.org/defer-panic-and-recover]</a></p>
<p>go既有常见的流程控制语句: if, for, switch, goto, 也有可用于goroutine的go语句. 下面介绍一些不那么常见的:defer, pannic和recover</p>
<h2 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h2><p>defer后面的表达式将会被放进一个list中, list中保存的被调用的函数将会在其他函数返回后执行. defer通常用于简化各种清理操作.</p>
<p>我们以将一个文件中的内容复制到另一个文件中为例:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CopyFile</span><span class="params">(dstName, srcName <span class="keyword">string</span>)</span> <span class="params">(written <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">    src, err := os.Open(srcName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dst, err := os.Create(dstName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    written, err = io.Copy(dst, src)</span><br><span class="line">    dst.Close()</span><br><span class="line">    src.Close()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正常情况下, 上述代码能正常执行, 但是当 os.Create 发生错误时, 将会导致源文件未被关闭. 一个很简单的补救措施是在第二个return语句之前添加close操作. 但是在复杂的程序中这种bug未必能及时发现并处理. defer正是用于此.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CopyFile</span><span class="params">(dstName, srcName <span class="keyword">string</span>)</span> <span class="params">(written <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">    src, err := os.Open(srcName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> src.Close()</span><br><span class="line"></span><br><span class="line">    dst, err := os.Create(dstName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> dst.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> io.Copy(dst, src)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>defer允许打开文件后立即关闭, 而不用考虑函数中有多少return语句</p>
<p>defer语句的行为简单且可预测, 依据于三条规则</p>
<h3 id="defer表达式的值在defer表达式定义时就已明确"><a href="#defer表达式的值在defer表达式定义时就已明确" class="headerlink" title="defer表达式的值在defer表达式定义时就已明确"></a>defer表达式的值在defer表达式定义时就已明确</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line">    i++</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码中, defer表达式中用到了i这个变量，i在初始化之后的值为0，接着程序执行到defer表达式这一行，表达式所用到的i的值就为0了，接着，表达式被放入list，等待在return的时候被调用。所以，后面尽管有一个i++语句，仍然不能改变表达式 fmt.Println(i)的结果. 最终程序打印的结果为0</p>
<h3 id="defer表达式的调用顺序是按照先进后出的方式"><a href="#defer表达式的调用顺序是按照先进后出的方式" class="headerlink" title="defer表达式的调用顺序是按照先进后出的方式"></a>defer表达式的调用顺序是按照先进后出的方式</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> fmt.Print(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果为”3210”</p>
<h3 id="defer表达式中可以修改函数中的命名返回值"><a href="#defer表达式中可以修改函数中的命名返回值" class="headerlink" title="defer表达式中可以修改函数中的命名返回值"></a>defer表达式中可以修改函数中的命名返回值</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; i++ &#125;()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这个例子中, 返回值变量为i, 虽然函数return值为1, 但是因为defer在return后调用, 将i值加一, 最终返回值为2.</p>
<h2 id="panic-和-recover"><a href="#panic-和-recover" class="headerlink" title="panic 和 recover"></a>panic 和 recover</h2><p>panic是一个內建函数, 可以中断函数流程, 并进入panic处理流程. 当函数F调用panic, 函数F的执行被中断, 但是F中的defer函数可以正常执行, 然后F返回到被调用处. 在被调用处继续panic流程, 直到程序奔溃时的所有goroutine返回. </p>
<p>recover同样是个內建函数. 用于恢复panic流程且仅在defer中有效. 函数正常执行过程中调用recover会返回nil且没有其他任何效果. 如果当前goroutine处于panic流程中, 调用recover可以使程序恢复正常的执行.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f()</span><br><span class="line">    fmt.Println(<span class="string">"Returned normally from f."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">"Recovered in f"</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    fmt.Println(<span class="string">"Calling g."</span>)</span><br><span class="line">    g(<span class="number">0</span>)</span><br><span class="line">    fmt.Println(<span class="string">"Returned normally from g."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">3</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"Panicking!"</span>)</span><br><span class="line">        <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"%v"</span>, i))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">"Defer in g"</span>, i)</span><br><span class="line">    fmt.Println(<span class="string">"Printing in g"</span>, i)</span><br><span class="line">    g(i + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数g当参数大于3时陷入panic, 否则i+1并递归调用自己. 函数f定义了一个defer函数, 调用recover. 程序输出如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Calling g.</span><br><span class="line">Printing in g 0</span><br><span class="line">Printing in g 1</span><br><span class="line">Printing in g 2</span><br><span class="line">Printing in g 3</span><br><span class="line">Panicking!</span><br><span class="line">Defer in g 3</span><br><span class="line">Defer in g 2</span><br><span class="line">Defer in g 1</span><br><span class="line">Defer in g 0</span><br><span class="line">Recovered in f 4</span><br><span class="line">Returned normally from f.</span><br></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/golang学习/">golang学习</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/go关键字/">go关键字</a><a href="/tags/翻译/">翻译</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/05/25/Defer, Panic, and Recover/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand defer," itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/25/Recover/" title="Recover" itemprop="url">Recover</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-05-25T06:54:11.000Z" itemprop="datePublished"> Published 2018-05-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/05/25/Recover/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/17/最长上升子序列/" title="最长上升子序列" itemprop="url">最长上升子序列</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-05-17T01:23:19.000Z" itemprop="datePublished"> Published 2018-05-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="题目"><a href="#题目" class="headerlink" title="题目:"></a>题目:</h1><p>给定一个无序的整数数组，找到其中最长上升子序列的长度。</p>
<p><strong>示例</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: [10,9,2,5,3,7,101,18]</span><br><span class="line">输出: 4 </span><br><span class="line">解释: 最长的上升子序列是 [2,3,7,101]，它的长度是 4。</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>:</p>
<ul>
<li>可能会有多种最长上升子序列的组合，你只需要输出对应的长度即可。</li>
<li>你算法的时间复杂度应该为 O(n2) 。</li>
</ul>
<h1 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h1><h2 id="O-n-2-的解法"><a href="#O-n-2-的解法" class="headerlink" title="O(n^2) 的解法"></a>O(n^2) 的解法</h2><p>以序列a=[1, 7, 3, 5, 9, 4]为例 </p>
<p>想求以a[i] 结尾的最大递增子序列长度, 设为dp[i]. 需要遍历i之前的所有位置j, 在这些位置中, 找出能产生最大的dp[i]的j, 然后加1即为dp[i]</p>
<p>由于每个位置最短的递增子序列为当前位置的值本身, 可得初始条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp = [1 for _ in range(len(a))]</span><br></pre></td></tr></table></figure>

<p>举例, 对于a[2], j的取值为0, 1. 当j为0时, 最大递增子序列为[1, 3], 当j为1时, 因为7比3大, 所以依然为2</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">l = len(nums)</span><br><span class="line">dp = [<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(l)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, l):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, i):</span><br><span class="line">        <span class="keyword">if</span> nums[i] &gt; nums[j] <span class="keyword">and</span> dp[i] &lt; dp[j] + <span class="number">1</span>:</span><br><span class="line">            dp[i] = dp[j] + <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> max(dp)</span><br></pre></td></tr></table></figure>

<h2 id="O-nlogn-的解法"><a href="#O-nlogn-的解法" class="headerlink" title="O(nlogn) 的解法"></a>O(nlogn) 的解法</h2><p>设d[len]表示长度为len的最长子列的最小末尾元素</p>
<p>其变化过程如下:</p>
<ul>
<li><p>dp[0] = a[0] = 1</p>
</li>
<li><p>a[1] &gt; dp[0], 添加到dp末尾, 即dp[1] = a[1], 此时dp = [1, 7]</p>
</li>
<li><p>a[2]=3, 1&lt;3&lt;7, 所以将dp[1]替换为3. 末尾元素最小原则嘛. 此时dp = [1, 3]</p>
</li>
<li><p>a[3] = 5, 大于dp[1], 末尾添加. dp = [1, 3, 5]</p>
</li>
<li><p>a[4] = 9, 同理 dp= [1, 3, 5, 9]</p>
</li>
<li><p>a[5] = 4, 替换dp[2], dp = [1, 3, 4, 9]</p>
</li>
</ul>
<p>最终, 最长为4</p>
<p>可以看到, 每一步有一个查找合适位置插入的过程, 这个过程可以用二分查找</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">size = len(nums)</span><br><span class="line">dp = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(size):</span><br><span class="line">    low, high = <span class="number">0</span>, len(dp) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> low &lt;= high:</span><br><span class="line">        mid = (low + high) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> dp[mid] &gt;= nums[x]:</span><br><span class="line">            high = mid - <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> low &gt;= len(dp):</span><br><span class="line">        dp.append(nums[x])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dp[low] = nums[x]</span><br><span class="line"><span class="keyword">return</span> len(dp)</span><br></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/LeetCode/">LeetCode</a><a href="/tags/动态规划/">动态规划</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/05/17/最长上升子序列/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/08/Python源码解读-List/" title="Python源码解读_List" itemprop="url">Python源码解读_List</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-05-08T09:33:35.000Z" itemprop="datePublished"> Published 2018-05-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <!-- TOC -->

<ul>
<li><a href="#1-pylistobject对象">1. PyListObject对象</a></li>
<li><a href="#2-pylistobject对象的创建与维护">2. PyListObject对象的创建与维护</a><ul>
<li><a href="#21-创建对象">2.1. 创建对象</a></li>
<li><a href="#22-设置元素">2.2. 设置元素</a></li>
<li><a href="#23-插入元素">2.3. 插入元素</a></li>
<li><a href="#24-删除元素">2.4. 删除元素</a></li>
</ul>
</li>
<li><a href="#3-pylistobject-对象缓冲池">3. PyListObject 对象缓冲池</a></li>
</ul>
<!-- /TOC -->

<h1 id="1-PyListObject对象"><a href="#1-PyListObject对象" class="headerlink" title="1. PyListObject对象"></a>1. PyListObject对象</h1><p>定义:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD</span><br><span class="line"></span><br><span class="line">    PyObject **ob_item;</span><br><span class="line"></span><br><span class="line">    Py_ssize_t allocated;</span><br><span class="line">&#125; PyListObject;</span><br></pre></td></tr></table></figure>

<p>问题:</p>
<blockquote>
<p>ob_size 和 allocated的联系</p>
</blockquote>
<p>PyListObject 所采用的内存策略并不是需要多少内存才申请多大的内存, 在每一次需要申请内存的时候, PyListObject总会申请一大块内存, 这时申请的内存大小记录在 allocted中, 而实际使用的内存数量则记录在ob_size中.</p>
<h1 id="2-PyListObject对象的创建与维护"><a href="#2-PyListObject对象的创建与维护" class="headerlink" title="2. PyListObject对象的创建与维护"></a>2. PyListObject对象的创建与维护</h1><h2 id="2-1-创建对象"><a href="#2-1-创建对象" class="headerlink" title="2.1. 创建对象"></a>2.1. 创建对象</h2><ul>
<li>PYList_New<br>这个函数接受一个size参数, 从而允许我们创建一个PyListObject对象的同时指定该列表初始的元素个数</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[listobject.c]</span><br><span class="line"></span><br><span class="line">PyObject *</span><br><span class="line">PyList_New(Py_ssize_t size)</span><br><span class="line">&#123;</span><br><span class="line">	PyListObject *op;</span><br><span class="line">	<span class="keyword">size_t</span> nbytes;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (size &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		PyErr_BadInternalCall();</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算需要的内存数量</span></span><br><span class="line">	nbytes = size * <span class="keyword">sizeof</span>(PyObject *);</span><br><span class="line">	<span class="comment">/* Check for overflow */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 溢出检查</span></span><br><span class="line">	<span class="keyword">if</span> (nbytes / <span class="keyword">sizeof</span>(PyObject *) != (<span class="keyword">size_t</span>)size)</span><br><span class="line">		<span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line">	<span class="keyword">if</span> (num_free_lists) &#123;</span><br><span class="line">        <span class="comment">// 缓冲池可用</span></span><br><span class="line">		num_free_lists--;</span><br><span class="line">		op = free_lists[num_free_lists];</span><br><span class="line">		_Py_NewReference((PyObject *)op);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		op = PyObject_GC_New(PyListObject, &amp;PyList_Type);</span><br><span class="line">		<span class="keyword">if</span> (op == <span class="literal">NULL</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为PyListObject对象中维护的元素列表申请空间</span></span><br><span class="line">	<span class="keyword">if</span> (size &lt;= <span class="number">0</span>)</span><br><span class="line">		op-&gt;ob_item = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		op-&gt;ob_item = (PyObject **) PyMem_MALLOC(nbytes);</span><br><span class="line">		<span class="keyword">if</span> (op-&gt;ob_item == <span class="literal">NULL</span>) &#123;</span><br><span class="line">			Py_DECREF(op);</span><br><span class="line">			<span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memset</span>(op-&gt;ob_item, <span class="number">0</span>, nbytes);</span><br><span class="line">	&#125;</span><br><span class="line">	op-&gt;ob_size = size;</span><br><span class="line">	op-&gt;allocated = size;</span><br><span class="line">	_PyObject_GC_TRACK(op);</span><br><span class="line">	<span class="keyword">return</span> (PyObject *) op;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Python的列表对象实际上是分为两部分的, 一是PyListObject对象本身, 二是PyListObject对象维护的元素列表. 这是两块分离的内存, 通过ob_item建立联系.</p>
<p>在Python2.5 中, 默认free_lists中最多会维护80个PyListObject对象</p>
<h2 id="2-2-设置元素"><a href="#2-2-设置元素" class="headerlink" title="2.2. 设置元素"></a>2.2. 设置元素</h2><p>在第一个PyListObject创建的时候, 这时的num_free_lists为0, 这时会绕过对象缓冲池, 转而调用PyObject_GC_New在系统堆上创建一个新的PyListObject对象</p>
<p>当向list中添加元素时, 发生的情况是:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">PyList_SetItem(<span class="keyword">register</span> PyObject *op, <span class="keyword">register</span> Py_ssize_t i,</span><br><span class="line">               <span class="keyword">register</span> PyObject *newitem)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">register</span> PyObject *olditem;</span><br><span class="line">	<span class="keyword">register</span> PyObject **p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类型检查</span></span><br><span class="line">	<span class="keyword">if</span> (!PyList_Check(op)) &#123;</span><br><span class="line">		Py_XDECREF(newitem);</span><br><span class="line">		PyErr_BadInternalCall();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 索引检查</span></span><br><span class="line">	<span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= ((PyListObject *)op) -&gt; ob_size) &#123;</span><br><span class="line">		Py_XDECREF(newitem);</span><br><span class="line">		PyErr_SetString(PyExc_IndexError,</span><br><span class="line">				<span class="string">"list assignment index out of range"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	p = ((PyListObject *)op) -&gt; ob_item + i;</span><br><span class="line">	olditem = *p;</span><br><span class="line">	*p = newitem;</span><br><span class="line">	Py_XDECREF(olditem);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置元素时, 首先会进行类型检查, 然后进行索引的有效性检查, 然后将待加入的PyObject* 指针放到指定的位置, 然后调整引用计数, 将这个位置原来存放的对象的引用计数减1</p>
<h2 id="2-3-插入元素"><a href="#2-3-插入元素" class="headerlink" title="2.3. 插入元素"></a>2.3. 插入元素</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">PyList_Insert(PyObject *op, Py_ssize_t where, PyObject *newitem)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (!PyList_Check(op)) &#123;</span><br><span class="line">		PyErr_BadInternalCall();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ins1((PyListObject *)op, where, newitem);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">ins1(PyListObject *self, Py_ssize_t where, PyObject *v)</span><br><span class="line">&#123;</span><br><span class="line">	Py_ssize_t i, n = self-&gt;ob_size;</span><br><span class="line">	PyObject **items;</span><br><span class="line">	<span class="keyword">if</span> (v == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		PyErr_BadInternalCall();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n == PY_SSIZE_T_MAX) &#123;</span><br><span class="line">		PyErr_SetString(PyExc_OverflowError,</span><br><span class="line">			<span class="string">"cannot add more objects to list"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用list_resize 保证有足够的内存</span></span><br><span class="line">	<span class="keyword">if</span> (list_resize(self, n+<span class="number">1</span>) == <span class="number">-1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (where &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		where += n;</span><br><span class="line">		<span class="keyword">if</span> (where &lt; <span class="number">0</span>)</span><br><span class="line">			where = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (where &gt; n)</span><br><span class="line">		where = n;</span><br><span class="line">	items = self-&gt;ob_item;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移动元素</span></span><br><span class="line">	<span class="keyword">for</span> (i = n; --i &gt;= where; )</span><br><span class="line">		items[i+<span class="number">1</span>] = items[i];</span><br><span class="line">	Py_INCREF(v);</span><br><span class="line">	items[where] = v;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">list_resize(PyListObject *self, Py_ssize_t newsize)</span><br><span class="line">&#123;</span><br><span class="line">	PyObject **items;</span><br><span class="line">	<span class="keyword">size_t</span> new_allocated;</span><br><span class="line">	Py_ssize_t allocated = self-&gt;allocated;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [1]</span></span><br><span class="line">	<span class="keyword">if</span> (allocated &gt;= newsize &amp;&amp; newsize &gt;= (allocated &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">		assert(self-&gt;ob_item != <span class="literal">NULL</span> || newsize == <span class="number">0</span>);</span><br><span class="line">		self-&gt;ob_size = newsize;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	new_allocated = (newsize &gt;&gt; <span class="number">3</span>) + (newsize &lt; <span class="number">9</span> ? <span class="number">3</span> : <span class="number">6</span>) + newsize;</span><br><span class="line">	<span class="keyword">if</span> (newsize == <span class="number">0</span>)</span><br><span class="line">		new_allocated = <span class="number">0</span>;</span><br><span class="line">	items = self-&gt;ob_item;</span><br><span class="line">	<span class="keyword">if</span> (new_allocated &lt;= ((~(<span class="keyword">size_t</span>)<span class="number">0</span>) / <span class="keyword">sizeof</span>(PyObject *)))</span><br><span class="line">		PyMem_RESIZE(items, PyObject *, new_allocated);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		items = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">if</span> (items == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		PyErr_NoMemory();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	self-&gt;ob_item = items;</span><br><span class="line">	self-&gt;ob_size = newsize;</span><br><span class="line">	self-&gt;allocated = new_allocated;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>[1]如果 newsize &lt; allocated &amp;&amp; newsize &gt; allocated / 2, 直接调整ob_size大小</li>
<li>其他情况直接调用 realloc</li>
</ul>
<p><img src="http://p3euxxfa8.bkt.clouddn.com/2018-05-08-16-59-07.png" alt="像列表中插入元素"></p>
<h2 id="2-4-删除元素"><a href="#2-4-删除元素" class="headerlink" title="2.4. 删除元素"></a>2.4. 删除元素</h2><p>PyListObject 的删除操作时通过 listremove 操作完成的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[listobject.c]</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">listremove(PyListObject *self, PyObject *v)</span><br><span class="line">&#123;</span><br><span class="line">	Py_ssize_t i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; self-&gt;ob_size; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> cmp = PyObject_RichCompareBool(self-&gt;ob_item[i], v, Py_EQ);</span><br><span class="line">		<span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (list_ass_slice(self, i, i+<span class="number">1</span>,</span><br><span class="line">					   (PyObject *)<span class="literal">NULL</span>) == <span class="number">0</span>)</span><br><span class="line">				Py_RETURN_NONE;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	PyErr_SetString(PyExc_ValueError, <span class="string">"list.remove(x): x not in list"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除操作, Python遍历整个列表, 将待删除的元素和PyListObject中的每一个元素对比, 大于0表示列表中的某个元素与待删除的元素匹配. 发现匹配的元素将立即调用 list_ass_slice 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">list_ass_slice(PyListObject *a, Py_ssize_t ilow, Py_ssize_t ihigh, PyObject *v)</span><br></pre></td></tr></table></figure>

<p>list_ass_slice 的完整功能为:</p>
<ul>
<li>a[ilow:ihigh] = v if v != NULL; 替换操作</li>
<li>del a[ilow:ihigh] = v if v != NULL; 删除</li>
</ul>
<p>最后一个参数的值决定了实用哪种操作</p>
<p>当进行删除操作时, 实际上是通过简单的移动内存来完成的, 所以调用remove操作时, 一定会导致内存移动操作的产生.</p>
<h1 id="3-PyListObject-对象缓冲池"><a href="#3-PyListObject-对象缓冲池" class="headerlink" title="3. PyListObject 对象缓冲池"></a>3. PyListObject 对象缓冲池</h1><p>在PyListObject对象被销毁的时候, free_lists中将会获得被销毁的对象</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[listobject.c]</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">list_dealloc(PyListObject *op)</span><br><span class="line">&#123;</span><br><span class="line">	Py_ssize_t i;</span><br><span class="line">	PyObject_GC_UnTrack(op);</span><br><span class="line">	Py_TRASHCAN_SAFE_BEGIN(op)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 销毁list对象维护的元素列表</span></span><br><span class="line">	<span class="keyword">if</span> (op-&gt;ob_item != <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line">		i = op-&gt;ob_size;</span><br><span class="line">		<span class="keyword">while</span> (--i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			Py_XDECREF(op-&gt;ob_item[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		PyMem_FREE(op-&gt;ob_item);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 释放PyListObject自身</span></span><br><span class="line">	<span class="keyword">if</span> (num_free_lists &lt; MAXFREELISTS &amp;&amp; PyList_CheckExact(op))</span><br><span class="line">		free_lists[num_free_lists++] = op;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		op-&gt;ob_type-&gt;tp_free((PyObject *)op);</span><br><span class="line">	Py_TRASHCAN_SAFE_END(op)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>►<a class="article-category-link" href="/categories/Python/源码/">源码</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/源码解读/">源码解读</a><a href="/tags/Dict/">Dict</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/05/08/Python源码解读-List/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/03/乘积最大子序列/" title="乘积最大子序列" itemprop="url">乘积最大子序列</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-05-03T03:33:22.000Z" itemprop="datePublished"> Published 2018-05-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>给定一个整数数组 nums ，找出一个序列中乘积最大的连续子序列（该序列至少包含一个数）。</p>
<p>示例 1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: [2,3,-2,4],</span><br><span class="line">输出: 6</span><br><span class="line">解释: 子数组 [2,3] 有最大乘积 6。</span><br></pre></td></tr></table></figure>

<p>示例 2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: [-2,0,-1],</span><br><span class="line">输出: 0</span><br><span class="line">解释: 结果不能为 2, 因为 [-2,-1] 不是子数组。</span><br></pre></td></tr></table></figure>

<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><p>前 n 位的乘积最大子序列分以下3种情况：</p>
<ol>
<li><p>前n - 1位的乘积最小子序列的乘积 * A[n]最大</p>
</li>
<li><p>前n - 1位的乘积最大子序列的乘积 * A[n]最大</p>
</li>
<li><p>前n - 1位的乘积最大子序列和乘积最小子序列的乘积 * A[n]都不是最大，而A[n]本身最大</p>
</li>
</ol>
<p>f_max(n)表示到原数组第n位时，乘积最大子序列的乘积，f_min(n)表示到原数组第n位时，乘积最小子序列的乘积</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f_max(n) = max(f_max(n - 1) * A[n], f_min(n - 1) * A[n], A[n])</span><br></pre></td></tr></table></figure>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProduct</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 用一个二维数组表示每次运算最大值和最小值</span></span><br><span class="line">        res = [[<span class="number">0</span>, <span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">        res[<span class="number">0</span>][<span class="number">0</span>], res[<span class="number">0</span>][<span class="number">1</span>] = nums[<span class="number">0</span>], nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        max_value = nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> index &lt; n:</span><br><span class="line">            <span class="comment"># 一个可能的最值（最大最小不知）</span></span><br><span class="line">            t1 = res[index - <span class="number">1</span>][<span class="number">0</span>] * nums[index]</span><br><span class="line">            <span class="comment"># 另一个可能的最值（最大最小不知）</span></span><br><span class="line">            t2 = res[index - <span class="number">1</span>][<span class="number">1</span>] * nums[index]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># min</span></span><br><span class="line">            res[index][<span class="number">1</span>] = min(t1, t2, nums[index])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># max</span></span><br><span class="line">            res[index][<span class="number">0</span>] = max(t1, t2, nums[index])</span><br><span class="line"></span><br><span class="line">            max_value = max(res[index][<span class="number">0</span>], max_value)</span><br><span class="line"></span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> max_value</span><br></pre></td></tr></table></figure>

<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img src="http://p3euxxfa8.bkt.clouddn.com/d6554d2316335dc8836b9414514311eb.png" alt></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/LeetCode/">LeetCode</a><a href="/tags/动态规划/">动态规划</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/05/03/乘积最大子序列/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/04/26/django集成markdown/" title="django集成markdown" itemprop="url">django集成markdown</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-04-26T08:38:49.000Z" itemprop="datePublished"> Published 2018-04-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>最近开发完Django blog的基本功能, 想在后台中集成markdown富文本编辑. 以下是开发流程</p>
<h2 id="mdeditor的使用"><a href="#mdeditor的使用" class="headerlink" title="mdeditor的使用"></a>mdeditor的使用</h2><p>经过大致的比对, 最终选择了django-mdeditor这个库.Django-mdeditor 是基于<a href="https://github.com/pandao/editor.md" target="_blank" rel="noopener">editor.md</a> 的一个 django Markdown 文本编辑插件应用, 支持Editor.md的大部分功能, 这里只做简单的基本功能配置</p>
<h3 id="基本配置使用"><a href="#基本配置使用" class="headerlink" title="基本配置使用"></a>基本配置使用</h3><ul>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-mdeditor</span><br></pre></td></tr></table></figure>
</li>
<li><p>setting设置<br>在setting.py的INSTALLED_APPS 中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">        ...</span><br><span class="line">        &apos;mdeditor&apos;,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>urls配置<br>在项目的总urls.py中添加</p>
</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">path(<span class="string">'mdeditor/'</span>, include(<span class="string">'mdeditor.urls'</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>同步<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>到这步基本的设置就完成了, 在后台编辑博客可以看到的界面如下:<br><img src="http://blogsk.oss-us-west-1.aliyuncs.com/django.png" alt></p>
<h3 id="后端生成html文本"><a href="#后端生成html文本" class="headerlink" title="后端生成html文本"></a>后端生成html文本</h3><p>在后台书写完成的博客, 需要在前端页面中展示. 将markdown生成对应的html页面的插件也很多. 这里选用<a href="https://github.com/lepture/mistune" target="_blank" rel="noopener">mistune</a></p>
<ul>
<li>自定义render<br>为了便于识别语言简写, 需要对mistune原本的render做一定的修改, 直接在view中继承Renderer即可</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomerRender</span><span class="params">(mistune.Renderer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">block_code</span><span class="params">(self, code, lang=None)</span>:</span></span><br><span class="line">        <span class="string">"""Rendering block level code. ``pre &gt; code``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param code: text content of the code block.</span></span><br><span class="line"><span class="string">        :param lang: language of the given code.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        code = code.rstrip(<span class="string">'\n'</span>)</span><br><span class="line">        lang_dic = &#123;</span><br><span class="line">            <span class="string">'py'</span>: <span class="string">'python'</span>,</span><br><span class="line">            <span class="string">'js'</span>: <span class="string">'javascript'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lang:</span><br><span class="line">            code = escape(code, smart_amp=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&lt;pre&gt;&lt;code&gt;%s\n&lt;/code&gt;&lt;/pre&gt;\n'</span> % code</span><br><span class="line">        code = escape(code, quote=<span class="literal">True</span>, smart_amp=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;pre&gt;&lt;code class="%s"&gt;%s\n&lt;/code&gt;&lt;/pre&gt;\n'</span> % (lang_dic.get(lang, lang), code)</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">以上代码中可以自己定义lang_dic.</span><br><span class="line"></span><br><span class="line">这里这样处理是为了方便前端使用highlight.js高亮代码块</span><br><span class="line"></span><br><span class="line">- 完成转换</span><br><span class="line">```py</span><br><span class="line"></span><br><span class="line">blog_content = mistune.markdown(blog.content)</span><br></pre></td></tr></table></figure>

<h3 id="前端使用highlight-js高亮代码块"><a href="#前端使用highlight-js高亮代码块" class="headerlink" title="前端使用highlight.js高亮代码块"></a>前端使用highlight.js高亮代码块</h3><p>在head头引入相关文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'js/styles/rainbow.css' %&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/highlight.pack.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>hljs.initHighlightingOnLoad();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在前端也能正常显示了.效果图:<br><img src="http://p3euxxfa8.bkt.clouddn.com/0dbec89b17a38cbc04222d34cbc92acd.png" alt></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Django学习/">Django学习</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Django/">Django</a><a href="/tags/markdown/">markdown</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/04/26/django集成markdown/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/04/25/最大子序和/" title="最大子序和" itemprop="url">最大子序和</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-04-25T02:47:04.000Z" itemprop="datePublished"> Published 2018-04-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定一个整数数组 nums ，找到一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。</p>
<p><strong>示例</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">输入: [-2,1,-3,4,-1,2,1,-5,4],</span><br><span class="line">输出: 6</span><br><span class="line">解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。</span><br></pre></td></tr></table></figure>

<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>穷举</p>
<p>直接找出所有可能的连续子序列, 求得其和最大值</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">length = len(nums)</span><br><span class="line">max_sum = nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">    tem_sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(i, length):</span><br><span class="line">        tem_sum += nums[j]</span><br><span class="line">    max_sum = max(max_sum, tem_sum)</span><br><span class="line"><span class="keyword">return</span> max_sum</span><br></pre></td></tr></table></figure>

<p>很明显, 上述解法的时间复杂度为O(N^2). 提交会超时</p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p> 如果一个数加上一个负数, 其值一定比这个数小, 同样的道理 ,如果一个子序列的和为负数, 那么可以用下一个值作为序列的起点.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        max_len = len(nums)</span><br><span class="line">        max_sum, max_tem = nums[<span class="number">0</span>], nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(max_len):</span><br><span class="line">            <span class="keyword">if</span> max_tem &lt; <span class="number">0</span>:</span><br><span class="line">                max_tem = nums[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                max_tem += nums[i]</span><br><span class="line"></span><br><span class="line">            max_sum = max(max_sum, max_tem)</span><br><span class="line">        <span class="keyword">return</span> max_sum</span><br></pre></td></tr></table></figure>

<p>结果<br><img src="http://p3euxxfa8.bkt.clouddn.com/3d8d64312758ec766c1f7737a6bc10e1.png" alt></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/LeetCode/">LeetCode</a><a href="/tags/动态规划/">动态规划</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/04/25/最大子序和/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/04/18/最小路径之和/" title="最小路径之和" itemprop="url">最小路径之和</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-04-18T07:10:33.000Z" itemprop="datePublished"> Published 2018-04-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定一个包含非负整数的 m x n 网格，找到一条从左上角到右下角的可以使数字之和最小的路径。</p>
<p>说明: 每次只能向下或者向右移动一步。</p>
<p>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">[</span><br><span class="line">  [1,3,1],</span><br><span class="line">  [1,5,1],</span><br><span class="line">  [4,2,1]</span><br><span class="line">]</span><br><span class="line">输出: 7</span><br><span class="line">解释: 因为路径 1→3→1→1→1 的总和最小。</span><br></pre></td></tr></table></figure>

<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>因为只能向下或者向右移动一步, 以dp[i][j]表示移动到目的地的最小路径之和的状态转移情况应该分为两种:</p>
<ul>
<li>dp[i-1][j] + grid[i][j]</li>
<li>dp[i][j-1] + grid[i][j]</li>
</ul>
<p>然后取其中最小的即可.</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minPathSum</span><span class="params">(self, grid)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type grid: List[List[int]]</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        len_row = len(grid)</span><br><span class="line">        len_col = len(grid[<span class="number">0</span>])</span><br><span class="line">        dp = [[<span class="number">0</span> <span class="keyword">for</span> col <span class="keyword">in</span> range(len_col)] <span class="keyword">for</span> row <span class="keyword">in</span> range(len_row)]  <span class="comment"># 初始化一个新的二维数组, 用二维数组记录移动到每个位置的最小路径之和</span></span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = grid[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 考虑为极限情况(只有一行或者一列的情况)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len_row):</span><br><span class="line">            dp[i][<span class="number">0</span>] = dp[i<span class="number">-1</span>][<span class="number">0</span>] + grid[i][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len_col):</span><br><span class="line">            dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j<span class="number">-1</span>] + grid[<span class="number">0</span>][j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len_row):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len_col):</span><br><span class="line">                dp[i][j] = grid[i][j] + min(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[len_row<span class="number">-1</span>][len_col<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>

<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p><img src="http://p3euxxfa8.bkt.clouddn.com/52c2d2e629305b75aaff1630635f7821.png" alt></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/LeetCode/">LeetCode</a><a href="/tags/动态规划/">动态规划</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/04/18/最小路径之和/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/04/18/python3使用ldap认证/" title="python3使用ldap认证" itemprop="url">python3使用ldap认证</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-04-18T03:29:37.000Z" itemprop="datePublished"> Published 2018-04-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>最近在写后台登录时用到ldap认证. 将相关的知识记录下来.</p>
<p>首先是Python3中有专门的ldap3库, 其<a href="http://ldap3.readthedocs.io/tutorial_operations.html" target="_blank" rel="noopener">文档</a></p>
<p>然后登录逻辑为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户登录时首先检查本地缓存中是否有相应的用户, 没有的情况下登录远程ldap服务器, 通过管理员账号查找所在域中是否有相关的账户</span><br></pre></td></tr></table></figure>

<p>相关的代码实现</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> login_form.is_valid():</span><br><span class="line">    user_name = request.POST.get(<span class="string">'username'</span>, <span class="string">''</span>)</span><br><span class="line">    password = request.POST.get(<span class="string">'password'</span>, <span class="string">''</span>)</span><br><span class="line">    user = authenticate(username=user_name, password=password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> user.is_active:</span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">'access/index.html'</span>, &#123;<span class="string">'user'</span>: user&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = check_user(user_name, password)  <span class="comment">## 本地数据库不存在, 在ldap服务器中开始验证</span></span><br><span class="line">        <span class="keyword">if</span> res:</span><br><span class="line">            user = UserProfile()</span><br><span class="line">            user.username = user_name</span><br><span class="line">            user.password = make_password(password)</span><br><span class="line">            user.is_active = <span class="number">0</span></span><br><span class="line">            user.save()</span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">'access/index.html'</span>, &#123;<span class="string">'user'</span>: user&#125;)</span><br></pre></td></tr></table></figure>

<p>ldap 的简单验证代码为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_user</span><span class="params">(user, password)</span>:</span></span><br><span class="line">    server = Server(AUTH_LDAP_SERVER_URI, get_info=ALL)</span><br><span class="line">    init_user = <span class="string">'domian\\%s'</span> % user</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        Connection(server, user=init_user, password=password, auto_bind=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python/">Python</a>►<a class="article-category-link" href="/categories/Python/Django学习/">Django学习</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/ldap3/">ldap3</a><a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/04/18/python3使用ldap认证/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/04/11/删除链表的倒数第N个节点/" title="删除链表的倒数第N个节点" itemprop="url">删除链表的倒数第N个节点</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="sksun" target="_blank" itemprop="author">sksun</a>
		
  <p class="article-time">
    <time datetime="2018-04-11T06:46:51.000Z" itemprop="datePublished"> Published 2018-04-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定一个链表，删除链表的倒数第 n 个节点并返回头结点。</p>
<p>例如，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给定一个链表: 1-&gt;2-&gt;3-&gt;4-&gt;5, 并且 n = 2.</span><br><span class="line"></span><br><span class="line">当删除了倒数第二个节点后链表变成了 1-&gt;2-&gt;3-&gt;5.</span><br></pre></td></tr></table></figure>

<p>说明:</p>
<p>给的 n 始终是有效的。</p>
<p>尝试一次遍历实现。</p>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>使用两个指针, 第一个指针比第二个指针先遍历n个节点, 这样当第一个指针到达尾部时, 第二个指针指向的位置正好是要删除的节点的上一位置</p>
<p>代码实现:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeNthFromEnd</span><span class="params">(self, head, n)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type head: ListNode</span></span><br><span class="line"><span class="string">        :type n: int</span></span><br><span class="line"><span class="string">        :rtype: ListNode</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        first_point = head</span><br><span class="line">        second_point = head</span><br><span class="line"></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; n:</span><br><span class="line">            first_point = first_point.next</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> first_point:</span><br><span class="line">            <span class="keyword">return</span> head.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> first_point.next:</span><br><span class="line">            first_point = first_point.next</span><br><span class="line">            second_point = second_point.next</span><br><span class="line"></span><br><span class="line">        second_point.next = second_point.next.next</span><br><span class="line">        <span class="keyword">return</span> head</span><br></pre></td></tr></table></figure>

<p>结果:<br><img src="http://p3euxxfa8.bkt.clouddn.com/2c70b1239c32dc81135421c980583b76.png" alt></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/LeetCode/">LeetCode</a><a href="/tags/链表/">链表</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/04/11/删除链表的倒数第N个节点/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/6/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/8/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/tools/Atom使用经验/" title="Atom使用经验">Atom使用经验<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Django/" title="Django">Django<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Django学习/" title="Django学习">Django学习<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/Django学习/" title="Django学习">Django学习<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Docker/" title="Docker">Docker<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux配置/" title="Linux配置">Linux配置<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/驱动安装/Python/" title="Python">Python<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/Python网络编程/" title="Python网络编程">Python网络编程<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/React/" title="React">React<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Web/" title="Web">Web<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Django/Web/" title="Web">Web<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/centos装机/" title="centos装机">centos装机<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/golang/" title="golang">golang<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/golang学习/" title="golang学习">golang学习<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/go学习/" title="go学习">go学习<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux踩坑记录/" title="linux踩坑记录">linux踩坑记录<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nginx/" title="nginx">nginx<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nsq学习/" title="nsq学习">nsq学习<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/play2/" title="play2">play2<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/redis/" title="redis">redis<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/scala/" title="scala">scala<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/scala类型系统/" title="scala类型系统">scala类型系统<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/tools/" title="tools">tools<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/tools/" title="tools">tools<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/web/" title="web">web<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/web基础/" title="web基础">web基础<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/windwos/" title="windwos">windwos<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/并发/" title="并发">并发<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/开源框架/" title="开源框架">开源框架<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/效率/" title="效率">效率<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/消息队列/" title="消息队列">消息队列<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/源码/" title="源码">源码<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>15</sup></a></li>
		  
		
		  
			<li><a href="/categories/系统调优/" title="系统调优">系统调优<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络编程/" title="网络编程">网络编程<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/开源框架/翻译/" title="翻译">翻译<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/" title="读书笔记">读书笔记<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/面试/" title="面试">面试<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/驱动安装/" title="驱动安装">驱动安装<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/高性能MySQL/" title="高性能MySQL">高性能MySQL<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/LeetCode/" title="LeetCode">LeetCode<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/动态规划/" title="动态规划">动态规划<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/读书笔记/" title="读书笔记">读书笔记<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Django/" title="Django">Django<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/字符串/" title="字符串">字符串<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/缓存/" title="缓存">缓存<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/MySQL/" title="MySQL">MySQL<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/链表/" title="链表">链表<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/集合框架/" title="集合框架">集合框架<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/翻译/" title="翻译">翻译<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/数组/" title="数组">数组<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/包管理/" title="包管理">包管理<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/源码阅读/" title="源码阅读">源码阅读<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Atom/" title="Atom">Atom<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/drf/" title="drf">drf<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/实战/" title="实战">实战<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/web/" title="web">web<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/tag/" title="tag">tag<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/go关键字/" title="go关键字">go关键字<sup>1</sup></a></li>
			
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="sksun">sksun</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
