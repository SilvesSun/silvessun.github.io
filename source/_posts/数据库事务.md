---
title: 数据库事务
date: 2019-03-20 10:30:50
tags:
- 事务
categories:
- 数据库
---

访问并可能更新数据库中各种数据项的一个程序执行单元(unit)

# 事务的4大属性
acid. 

- 原子性(Atomicity) 事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行

- 一致性(Consistency) 事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束

- 隔离性（Isolation） 多个事务并发执行时，一个事务的执行不应影响其他事务的执行

- 持久性（Durability）一个事务一旦提交，他对数据库的修改应该永久保存在数据库中

# 事务的隔离级别

`RAED UNCOMMITED` 读未提交, 使用查询语句不会加锁，可能会读到未提交的行（Dirty Read）

`READ COMMITED` 读已提交, 只对记录加记录锁，而不会在记录之间加间隙锁，所以允许新的记录插入到被锁定记录的附近，所以再多次使用查询语句时，可能得到不同的结果（Non-Repeatable Read）

`REPEATABLE READ` 可重复读, 多次读取同一范围的数据会返回第一次查询的快照，不会返回不同的数据行，但是可能发生幻读（Phantom Read）

`SERIALIZABLE` 可串行读, InnoDB 隐式地将全部的查询语句加上共享锁，解决了幻读的问题

每个事务的隔离级别其实都比上一级多解决了一个问题

**在MySQL数据库中，支持上面四种隔离级别，默认的为Repeatable read (可重复读)**

InnoDB 的默认级别是可重复读, 并通过 `间隙锁` 策略防止幻读的出现