---
title: 初识redis
date: 2018-09-03 11:31:08
tags:
- 缓存
categories:
- redis
---

Redis,  Remote Dictionary Server（远程数据服务） 是一个开源的, 基于内存的存储系统. 主要用于缓存, 消息中间件以及数据库. 支持的常见数据结构包括: 字符串, 散列, 列表, 集合, 有序集合这五种.

redis 的速度很快, 官方的数据时可以达到100000+的QPS（每秒内查询次数）. redis 这么快的理由主要有以下几点:

- 纯内存数据库, 决定了绝大部分操作都是纯内存操作, 读取速度快
- 采用单线程，避免了不必要的上下文切换和竞争条件，也不存在多进程或者多线程导致的切换而消耗 CPU，不用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗
- 采用非阻塞IO, IO多路复用. 
- 数据结构简单

## 客户端通信协议
redis 客户端和服务端通信采用的是基于tcp协议制定的 `RESP`(Redis Serialization Protocol, Redis序列化协议). 

### 1. 发送命令的格式

```
*<参数数量> CRLF
$<参数 1 的字节数量> CRLF
<参数 1 的数据> CRLF
...
$<参数 N 的字节数量> CRLF
<参数 N 的数据> CRLF
```

以`set hello world` 为例

参数有3个, 所以第一行为`*3`, 三个参数的字节数分别为355, 所以后几行为

```
$3
SET
$5
hello
$5
world
```

在实际传输过程中的显示为
`*3\r\n$3\r\n\SET\r\n\$5\r\nhello\r\n$5\r\nworld\r\n`

### 2. 返回结果的格式
- 状态回复, 第一个字节为`+`

- 错误回复, 第一个字节为`-`

- 整数回复, 第一个字节为`:`

- 字符串回复, 第一个字节为`$`

- 多条字符串回复, 第一个字节为 `*`


![2018-09-03-14-36-05](http://p3euxxfa8.bkt.clouddn.com/2018-09-03-14-36-05.png)

